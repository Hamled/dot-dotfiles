#!/usr/bin/env bash

function run_server() {
  local SERVER_NAME=emacs
  local SERVER="$(which -a "$SERVER_NAME" | sed "0,\|^$0\$|d" | head -n 1)"
  [[ ! -e "$SERVER" ]] && echo "$SERVER_NAME could not be found" && exit 1

  exec $SERVER ${@}
}

function run_client() {
  local CLIENT_NAME=emacsclient
  local CLIENT="$(which -a "$CLIENT_NAME" | head -n 1)"
  [[ ! -e "$CLIENT" ]] && echo "$CLIENT_NAME could not be found" && exit 1

  # If we're running in terminal mode actually wait
  local WAIT_ARG="-n"
  for ARG in "${@}"; do
    [[ $ARG == "-t" || $ARG == "--tty" || $ARG == "-nw" ]] && WAIT_ARG=""
  done

  exec $CLIENT -a="" -c $WAIT_ARG ${@}
}

# If we're trying to start server, do so
for ARG in "${@}"; do
  [[ "$ARG" == *"daemon" ]] && run_server ${@}
done

run_client ${@}
